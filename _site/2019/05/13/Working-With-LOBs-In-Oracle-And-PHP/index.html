<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Every failure is leading towards success.">
    <meta name="keywords"  content="zakun, blog, 博客, 随手记, php, mysql, nginx">
    <meta name="theme-color" content="#000000">
    
    <title>Working With LOBs In Oracle And PHP - zakun 随手记 | zakun Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/blog/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/blog/img/favicon.ico">

    <!-- Safari Webpage Icon    by-BY -->
    <link rel="apple-touch-icon" href="/blog/img/zk.png">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/blog/2019/05/13/Working-With-LOBs-In-Oracle-And-PHP/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/blog/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/blog/css/hux-blog.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/blog/css/syntax.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/blog/">zakun 随手记</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/blog/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/blog/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="/blog/tags/">Tags</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/blog/img/big_banner/post-bg-keybord.jpg" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/blog/img/big_banner/post-bg-keybord.jpg')
    }

    
</style>
<header class="intro-header" >
    <div class="header-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/blog/tags/#oracle" title="oracle">oracle</a>
                        
                        <a class="tag" href="/blog/tags/#php" title="php">php</a>
                        
                        <a class="tag" href="/blog/tags/#clob" title="clob">clob</a>
                        
                    </div>
                    <h1>Working With LOBs In Oracle And PHP</h1>
                    
                    
                    <h2 class="subheading">How to working oracle Lobs with php</h2>
                    
                    <span class="meta">Posted by zakun on May 13, 2019</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

				<h1 id="the-oracle--php-cookbook">The Oracle + PHP Cookbook</h1>

<h2 id="working-with-lobs-in-oracle-and-php">Working with LOBs in Oracle and PHP</h2>

<p><a href="https://www.oracle.com/technetwork/articles/fuecks-lobs-095315.html" target="_blank">原文链接</a></p>

<h3 id="hitting-the-4000-byte-limit-enter-lobs">Hitting the 4,000-byte limit? Enter LOBs…</h3>

<p>Downloads for this article:</p>
<ul>
  <li>Oracle Database 10g</li>
  <li>Zend Core for Oracle</li>
  <li>Apache HTTP Server 1.3 and later
Working with Oracle types like VARCHAR2 is fine, but what if you need to be able to store more than its 4,000-byte limit in one go? For this task, you need one of Oracle’s Long Object (LOB) types, which in turn requires that you learn how to use the PHP API for working with LOBs. That in itself can be daunting for those unfamiliar with it.</li>
</ul>

<p>In this “Oracle+PHP Cookbook” HowTo, you will learn the available LOB types and issues related to them, then explore examples of common LOB operations in PHP.</p>

<p>Long Objects in Oracle</p>

<p>Oracle provides the following LOB types:</p>

<ul>
  <li>BLOB, used to store binary data</li>
  <li>CLOB, used to store character data using the database character set encoding</li>
  <li>NCLOB, used to store Unicode character data using the national character set. Note that NCLOBs are, currently, not supported by the PHP OCI8 extension, which you’ll be using here.</li>
  <li>BFILE, used to reference external files under the operating system’s filesystem</li>
</ul>

<p>A further subcategory of LOB is the temporary LOB, which can be either a BLOB, CLOB, or NCLOB but is stored in the temporary tablespace until you free it.
Note that older versions of Oracle provided the LONG and LONG RAW types for character and binary data, respectively. With Oracle9i these were deprecated in favor of LOBs.</p>

<p>LOB storage. For the BLOB, CLOB, and NCLOB types, Oracle Database 10g is capable of storing up to 128TB in a single value, depending on your database block size and the “chunk” setting, defined for the LOB.</p>

<p>A LOB itself comprises two elements: the LOB content and the LOB locator, which is a “pointer” to the LOB content. This separation is required to allow Oracle to store and manage LOBs efficiently and it is reflected in the PHP APIs you use to INSERT, UPDATE, and SELECT LOBs (see below).</p>

<p>For the internal LOB types (i.e. not BFILEs) Oracle will store the content of the LOB “in-line” in the table, with the rest of the row, if the size of the LOB is less than 4KB. LOBs larger than 4KB are stored “out-of-line,” by default in the table’s tablespace. This approach allows small LOBs to be retrieved quickly while, for large LOBs, access times will be slower but overall performance, when scanning the table, is preserved.</p>

<p>There are further options for LOB storage and access—such as memory caching and buffering—which may improve performance, depending on the specifics of your application. For further information see the LOB Performance Guidelines and the Oracle Database Application Developer’s Guide - Large Objects in the Oracle documentation.</p>

<p>Restrictions on LOBs. A number of restrictions apply to the use of LOB types, the most important being their use in SQL statements. You cannot use a LOB type in any of the following queries.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT DISTINCT &lt;lob_type&gt;
ORDER BY &lt;lob_type&gt;
GROUP BY &lt;lob_col&gt;
</code></pre></div></div>

<p>It is also illegal to use a LOB type column for table joins, UNION, INTERSECTION, and MINUS statements.
Further restrictions apply to other aspects of the use of LOBs, such as you cannot use LOB as a primary key column. Again, see <a href="http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14249/toc.htm">Oracle Database Application Developer’s Guide</a> - Large Objects for details.</p>

<h3 id="clobs-and-character-sets">CLOBs and Character Sets</h3>

<p>The default character set for your database is defined by the parameter NLS_CHARACTERSET and text placed in a CLOB is expected to be encoded using this character set. Use this SQL to determine your databases character set encoding:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT value FROM nls_database_parameters WHERE parameter = 'NLS_CHARACTERSET'
</code></pre></div></div>

<p>Given lack of support for NCLOBs in PHP, you may want to consider using Unicode encoding as the database character, such as UTF-8, which can be done (given sufficient privileges) using the statement:
ALTER DATABASE CHARACTER SET UTF8
Note: do not attempt this without understanding the impact, especially if you have existing data or application code using a different character set. See the Oracle Globalization Support Guide and An Overview on Globalizing Oracle PHP Applications for more information.
Working with LOBs</p>

<p>The discussion here will focus on PHP’s OCI8 extension. It’s also worth noting that Oracle provides the DBMS_LOB package, containing parallel procedures and functions for working with LOBs using PL/SQL.</p>

<p>The PHP OCI8 extension registers a PHP class called “OCI-Lob” in the global PHP namespace. When you execute a SELECT statement, for example, where one of columns is a LOB type, PHP will bind this automatically to an OCI-Lob object instance. Once you have a reference to an OCI-Lob object, you can then call methods like load() and save() to access or modify the contents of the LOB.</p>

<p>The available OCI-Lob methods will depend on your PHP version, PHP5 in particular having gained methods like read() , seek() , and append() . The PHP Manual is a little unclear, in this case, on the version numbers so if in doubt you can verify using the following script.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
foreach (get_class_methods('OCI-Lob') as $method ) {
	print "OCI-Lob::$method()\n";
}
?&gt;
</code></pre></div></div>

<p>On my system, running PHP 5.0.5, I get the following list of methods:</p>

<p>OCI-Lob::load()
OCI-Lob::tell()
OCI-Lob::truncate()
OCI-Lob::erase()
OCI-Lob::flush()
OCI-Lob::setbuffering()
OCI-Lob::getbuffering()
OCI-Lob::rewind()
OCI-Lob::read()
OCI-Lob::eof()
OCI-Lob::seek()
OCI-Lob::write()
OCI-Lob::append()
OCI-Lob::size()
OCI-Lob::writetofile()
OCI-Lob::writetemporary()
OCI-Lob::close()
OCI-Lob::save()
OCI-Lob::savefile()
OCI-Lob::free()</p>

<p>In practice, the PHP 4.x OCI8 extension supports reading or writing of complete LOBs only, which is the most common use case in a Web application. PHP5 extends this to allow reading and writing of “chunks” of a LOB as well as supporting LOB buffering with the methods setBuffering() and getBuffering() . PHP5 also provides the stand-alone functions oci_lob_is_equal() and oci_lob_copy() .
The examples here will use the new PHP5 OCI function names (e.g. oci_parse instead of OCIParse ). Examples use the following sequence and table:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE SEQUENCE mylobs_id_seq
	NOMINVALUE
	NOMAXVALUE
	NOCYCLE
	CACHE 20
	NOORDER
INCREMENT BY 1;

CREATE TABLE mylobs (
	id NUMBER PRIMARY KEY,
	mylob CLOB
)
</code></pre></div></div>

<p>Note that most of the examples here use CLOBs but the same logic can be applied almost exactly to BLOBs as well.
Inserting a LOB</p>

<p>To INSERT an internal LOB, you first need to initialize the LOB using the respective Oracle EMPTY_BLOB or EMPTY_CLOB functions—you cannot update a LOB that contains a NULL value.</p>

<p>Once initialized, you then bind the column to a PHP OCI-Lob object and update the LOB content via the object’s save() method.</p>

<p>The following script provides an example, returning the LOB type from the INSERT query:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
// connect to DB etc...

$sql = "INSERT INTO
		mylobs
		  (
			id,
			mylob
		  )
	   VALUES
		  (
			mylobs_id_seq.NEXTVAL,
			--Initialize as an empty CLOB
			EMPTY_CLOB()
		  )
	   RETURNING
		  --Return the LOB locator
		  mylob INTO :mylob_loc";

$stmt = oci_parse($conn, $sql);

// Creates an "empty" OCI-Lob object to bind to the locator
$myLOB = oci_new_descriptor($conn, OCI_D_LOB);

// Bind the returned Oracle LOB locator to the PHP LOB object
oci_bind_by_name($stmt, ":mylob_loc", $myLOB, -1, OCI_B_CLOB);

// Execute the statement using , OCI_DEFAULT - as a transaction
oci_execute($stmt, OCI_DEFAULT)
	or die ("Unable to execute query\n");

// Now save a value to the LOB
if ( !$myLOB-&gt;save('INSERT: '.date('H:i:s',time())) ) {

	// On error, rollback the transaction
	oci_rollback($conn);

} else {

	// On success, commit the transaction
	oci_commit($conn);

}

// Free resources
oci_free_statement($stmt);
$myLOB-&gt;free();


// disconnect from DB etc.
?&gt;
</code></pre></div></div>

<p>Notice how this example uses a transaction, instructing oci_execute with OCI_DEFAULT constant to wait for an oci_commit or an oci_rollback . This is important as I have two stages taking place in the INSERT—first create the row and second update the LOB.
Note that if I was working with a BLOB type, the only change needed (assuming a BLOB column) is to the oci_bind_by_name call:</p>

<p>oci_bind_by_name($stmt, “:mylob_loc”, $myLOB, -1, OCI_B_BLOB);
Alternatively, you can bind a string directly without specifying a LOB type;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
// etc.

$sql = "INSERT INTO
		  mylobs
		  (
			id,
			mylob
		  )
		VALUES
		  (
			mylobs_id_seq.NEXTVAL,
			:string
		  )
";

$stmt = oci_parse($conn, $sql);

$string = 'INSERT: '.date('H:i:s',time());

oci_bind_by_name($stmt, ':string', $string);

oci_execute($stmt)
	or die ("Unable to execute query\n");

// etc.
?&gt;
</code></pre></div></div>

<p>This approach simplifies the code significantly and is suitable when the data your want to write to the LOB is relatively small. In contrast, if you wished to stream the contents of the large file into a LOB, you might loop through the contents of the file calling write() and flush() on the PHP LOB object to write smaller chunks rather than having the entire file held in memory at a single instance.
Selecting a LOB</p>

<p>When a SELECT query contains a LOB column, PHP will automatically bind the column to an OCI-Lob object. For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
// etc.

$sql = "SELECT
		  *
		FROM
		  mylobs
		ORDER BY
		  Id
";

$stmt = oci_parse($conn, $sql);

oci_execute($stmt)
	or die ("Unable to execute query\n");

while ( $row = oci_fetch_assoc($stmt) ) {
	print "ID: {$row['ID']}, ";

	// Call the load() method to get the contents of the LOB
	print $row['MYLOB']-&gt;load()."\n";
}

// etc.
?&gt;
</code></pre></div></div>

<p>This can be further simplified using the OCI_RETURN_LOBS constant, used with oci_fetch_array(), instructing it to replace LOB objects with their values:
while ( $row = oci_fetch_array($stmt, OCI_ASSOC+OCI_RETURN_LOBS) ) {
    print “ID: {$row[‘ID’]}, {$row[‘MYLOB’]}\n”;
}
Updating a LOB
To UPDATE a LOB, it’s also possible to use the “RETURNING” command in the SQL, as with the above INSERT example, but a simpler approach is to SELECT … FOR UPDATE:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
// etc.

$sql = "SELECT
		   mylob
		FROM
		   mylobs
		WHERE
		   id = 3
		FOR UPDATE /* locks the row */
";

$stmt = oci_parse($conn, $sql);

// Execute the statement using OCI_DEFAULT (begin a transaction)
oci_execute($stmt, OCI_DEFAULT)
	or die ("Unable to execute query\n");

// Fetch the SELECTed row
if ( FALSE === ($row = oci_fetch_assoc($stmt) ) ) {
	oci_rollback($conn);
	die ("Unable to fetch row\n");
}

// Discard the existing LOB contents
if ( !$row['MYLOB']-&gt;truncate() ) {
	oci_rollback($conn);
	die ("Failed to truncate LOB\n");
}

// Now save a value to the LOB
if ( !$row['MYLOB']-&gt;save('UPDATE: '.date('H:i:s',time()) ) ) {

	// On error, rollback the transaction
	oci_rollback($conn);

} else {

	// On success, commit the transaction
	oci_commit($conn);

}

// Free resources
oci_free_statement($stmt);
$row['MYLOB']-&gt;free();


// etc.
?&gt;
</code></pre></div></div>

<p>As with the INSERT, I need to perform the UPDATE using a transaction. An important additional step is the call to truncate() . When updating a LOB with save(), it will replace the contents of the LOB beginning from the start up to the length of the new data. That means older content (if it was longer than the new content) may still be left in the LOB.
For PHP 4.x, where truncate() is unavailable, the following alternative solution uses Oracle’s EMPTY_CLOB() function to erase any existing contents in the LOB before saving new data to it.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$sql = "UPDATE
		   mylobs
		SET
			mylob = EMPTY_CLOB()
		WHERE
		   id = 2403
		RETURNING
			mylob INTO :mylob
";

$stmt = OCIParse($conn, $sql);

$mylob = OCINewDescriptor($conn,OCI_D_LOB);

OCIBindByName($stmt,':mylob',$mylob, -1, OCI_B_CLOB);

// Execute the statement using OCI_DEFAULT (begin a transaction)
OCIExecute($stmt, OCI_DEFAULT)
	or die ("Unable to execute query\n");

if ( !$mylob-&gt;save( 'UPDATE: '.date('H:i:s',time()) ) ) {

	OCIRollback($conn);
	die("Unable to update lob\n");

}

OCICommit($conn);
$mylob-&gt;free();
OCIFreeStatement($stmt);
</code></pre></div></div>

<h3 id="working-with-bfiles">Working with BFILES</h3>
<p>When using the BFILE type, INSERTs and UPDATEs mean telling Oracle where the file is located within the filesystem of the database server (which may not be the same machine as the Web server), rather than passing the file content. Using a SELECT statement, you can read the contents of the BFILE through Oracle, should you so desire, or call functions and procedures from the DBMS_LOB package to get information about the file.</p>

<p>The main advantage of BFILEs is being able to access the original files directly from the filesystem while still being able to locate files using SQL. This means, for example, images can be served directly by the Web server while I can keep track of the relationship between the table containing the BFILES and, say, a “users” table, telling me who uploaded the files.</p>

<p>As an example, I first need to update the table schema used above;</p>

<p>ALTER TABLE mylobs ADD( mybfile BFILE )
Next I need to register a directory alias with Oracle (this requires administrative privileges) and grant permissions to read it:
CREATE DIRECTORY IMAGES_DIR AS ‘/home/harryf/public_html/images’
GRANT READ ON DIRECTORY IMAGES_DIR TO scott
I can now INSERT some BFILE names like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
// etc.

// Build an INSERT for the BFILE names
$sql = "INSERT INTO
		mylobs
		  (
			id,
			mybfile
		  )
	   VALUES
		  (
			mylobs_id_seq.NEXTVAL,
			/*
			Pass the file name using the Oracle directory reference
			I created called IMAGES_DIR
			*/
			BFILENAME('IMAGES_DIR',:filename)
		  )";

$stmt = oci_parse($conn, $sql);

// Open the directory
$dir = '/home/harryf/public_html/images';
$dh = opendir($dir)
	or die("Unable to open $dir");

// Loop through the contents of the directory
while (false !== ( $entry = readdir($dh) ) ) {

	// Match only files with the extension .jpg, .gif or .png
	if ( is_file($dir.'/'.$entry) &amp;&amp; preg_match('/\.(jpg|gif|png)$/',$entry) ) {

		// Bind the filename of the statement
		oci_bind_by_name($stmt, ":filename", $entry);

		// Execute the statement
		if ( oci_execute($stmt) ) {
			print "$entry added\n";
		}
	}

}
</code></pre></div></div>

<p>If I need to, I can read the BFILE content through Oracle using the same approach as above where I selected CLOBs. Alternatively, if I need to get the filenames back so I can access them directly from the filesystem, I can call the DBMS_LOB.FILEGETNAME procedure like:
	&lt;?php
	// etc.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$sql = "SELECT
		  id
		FROM
		  mylobs
		WHERE
		  -- Select only BFILES which are not null
		  mybfile IS NOT NULL;

$stmt1 = oci_parse($conn, $sql);

oci_execute($stmt1)
	or die ("Unable to execute query\n");

$sql = "DECLARE
		  locator BFILE;
		  diralias VARCHAR2(30);
		  filename VARCHAR2(30);

		BEGIN

		  SELECT
			mybfile INTO locator
		  FROM
			mylobs
		  WHERE
			id = :id;

		  -- Get the filename from the BFILE
		  DBMS_LOB.FILEGETNAME(locator, diralias, filename);

		  -- Assign OUT params to bind parameters
		  :diralias:=diralias;
		  :filename:=filename;

	   END;";

$stmt2 = oci_parse($conn, $sql);

while ( $row = oci_fetch_assoc ($stmt1) ) {

	oci_bind_by_name($stmt2, ":id", $row['ID']);
	oci_bind_by_name ($stmt2, ":diralias", $diralias,30);
	oci_bind_by_name ($stmt2, ":filename", $filename,30);

	oci_execute($stmt2);
	print "{$row['ID']}: $diralias/$filename\n";

}
// etc.
?&gt;
</code></pre></div></div>

<p>Furthermore, you can use the DBMS_LOB.FILEEXISTS function to discover which files have been deleted via the operating system but are still referenced in the database.
Conclusion</p>

<p>In this HowTo you have been introduced to the different types of LOBs available in Oracle Database 10g and hopefully now understand their role in allowing large data entities to be stored efficiently in the database. You have also learned how to work with LOBs using PHP’s OCI8 API, covering the common use cases you will encounter while developing with Oracle and PHP.</p>



                <hr style="visibility: hidden;">

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/blog/2019/05/06/jquery%E6%82%AC%E6%B5%AE%E5%B1%82/" data-toggle="tooltip" data-placement="top" title="Jquery 悬浮层">
                        Previous<br>
                        <span>Jquery 悬浮层</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/blog/2019/05/22/%E5%85%A8%E9%9D%A2%E8%A7%A3%E6%9E%90jQuery%E4%B8%AD%E7%9A%84window%E4%B8%8Edocument%E7%9A%84%E7%94%A8%E6%B3%95%E5%8C%BA%E5%88%AB/" data-toggle="tooltip" data-placement="top" title="全面解析jQuery中$(window)与$(document)的用法区别">
                        Next<br>
                        <span>全面解析jQuery中$(window)与$(document)的用法区别</span>
                        </a>
                    </li>
                    
                </ul>


                <!--Gitalk评论start  -->
                
                <!-- 引入Gitalk评论插件  -->
                <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
                <script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
                <div id="gitalk-container"></div>
                <!-- 引入一个生产md5的js，用于对id值进行处理，防止其过长 -->
                <!-- Thank DF:https://github.com/NSDingFan/NSDingFan.github.io/issues/3#issuecomment-407496538 -->
                <script src="/blog/js/md5.min.js"></script>
                <script type="text/javascript">
                    var gitalk = new Gitalk({
                    clientID: '42d8113b72da2238320a',
                    clientSecret: '7c44fe6b2e732e37ac2b4554f09821ec791e93ee',
                    repo: 'blog',
                    owner: 'zakun',
                    admin: ['zakun'],
                    distractionFreeMode: true,
                    id: md5(location.pathname),
                    });
                    gitalk.render('gitalk-container');
                </script>
                
                <!-- Gitalk end -->

                

            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#jquery" title="jquery" rel="2">
                                    jquery
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
        			</div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                        <li><a href="https://jekyllrb.com/docs/structure">Jekyll</a></li>
                    
                        <li><a href="https://github.com/zakun">gitHub</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>






<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        // BY Fix:去除标题前的‘#’ issues:<https://github.com/qiubaiying/qiubaiying.github.io/issues/137>
        // anchors.options = {
        //   visible: 'always',
        //   placement: 'right',
        //   icon: '#'
        // };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    <li>
                        <a href="/blog/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <!-- add jianshu add target = "_blank" to <a> by BY -->
                    
                    

                    <!-- add Weibo, Zhihu by Hux, add target = "_blank" to <a> by Hux -->
                    
                    


                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/zakun">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; zakun 随手记 2023
                    <br>
                    Theme on <a href="https://github.com/zakun/blog.git">GitHub</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zakun&repo=blog&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/blog/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/blog/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/blog/js/hux-blog.min.js "></script>
service-worker
<!-- Service Worker -->

<script type="text/javascript">
    if(navigator.serviceWorker){
        // For security reasons, a service worker can only control the pages that are in the same directory level or below it. That's why we put sw.js at ROOT level.
        navigator.serviceWorker
            .register('/sw.js')
            .then((registration) => {console.log('Service Worker Registered. ', registration)})
            .catch((error) => {console.log('ServiceWorker registration failed: ', error)})
    }
</script>



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/ 
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers   
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async('/blog/js/jquery.tagcloud.js',function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-139110006-1';
    var _gaDomain = 'auto';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->




<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {
        var P = $('div.post-container'),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;    
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/blog/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>





<!-- Image to hack wechat -->
<img src="/img/apple-touch-icon.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
